as.phylogg <- function(Z,N,tip.label=as.character(1:N)){

#if (is(tip.label)){tip.label=as.character(1:N)}

  edgess<- (matrix(,max(Z),3))

z=cbind(Z[,c(2,1,3)],rep(NA,nrow(Z)))
z[,4]=(N+1):(max(Z)+1)
z=data.matrix(z)

cnt=1;
for (i in 1:nrow(z)){
  if (all(z[i,1:2]<=N))  {
    
    edgess[cnt,] = c(z[i,4],z[i,c(1,3)])
    edgess[cnt+1,] = c(z[i,4],z[i,2:3])
    cnt=cnt+2
    
  } else if (any(z[i,1:2]<=N))  {
    
    edgess[cnt,] = c(z[i,4],z[i,1],z[i,3]-z[z[,4]==z[i,1],3])
    edgess[cnt+1,] = c(z[i,4],z[i,2:3])
    cnt=cnt+2
    
  }else
    { 
      edgess[cnt,] = c(z[i,4],z[i,1],z[i,3]-z[z[,4]==z[i,1],3])
      edgess[cnt+1,] = c(z[i,4],z[i,2],z[i,3]-z[z[,4]==z[i,2],3])
      cnt=cnt+2
    }
}

edgess[edgess[,1]>N,1]= -1*(edgess[edgess[,1]>N,1]-max(edgess))+N+1
edgess[edgess[,2]>N,2]= -1*(edgess[edgess[,2]>N,2]-max(edgess))+N+1
#edges <- edges[-which(apply(edges,1,function(x){any(is.na(x))})),]
#edges <- edges[order(edges[,1]) ,]
 
Zp <- list(edge=edgess[,1:2], edge.length=edgess[,3],tip.label=tip.label,Nnode=max(edgess)-N)
class(Zp) <- "phylo"
return(Zp)
  
}

